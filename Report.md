# DO5_SimpleDocker

## Оглавление

   1. [Part 1. Готовый докер](#part-1-готовый-докер)
   2. [Part 2. Операции с контейнером](#part-2-операции-с-контейнером)
   3. [ Part 3. Мини веб-сервер](#part-3-мини-веб-сервер)
   4. [Part 4. Свой докер](#part-4-свой-докер)
   5. [Part 5. Dockle](#part-5-dockle)
   6. [Part 6. Базовый Docker Compose](#part-6-базовый-docker-compose)


## Part 0. Устонавливаем Docker с помощью apt репозитория
   
Перед первой установкой Docker Engine на новую хост-машину необходимо настроить aptрепозиторий Docker. После этого можно установить и обновить Docker из репозитория.

   Обновляем список доступных пакетов из репозиториев. `sudo apt-get update`
   
   ![alt text](screen/0/0.6.png)

   Устанавливаем пакеты ca-certificates (для работы с SSL-сертификатами) и curl (для загрузки файлов по URL).
   
   ![alt text](screen/0/0.1.png)
   
   Создаем директорию `/etc/apt/keyrings` с правами 0755 (владелец — чтение/запись/исполнение, остальные — чтение/исполнение) для хранения ключей репозиториев.
   
   ![alt text](screen/0/0.2.png)

   Скачиваем GPG-ключ Docker и сохраняем его в `/etc/apt/keyrings/docker.asc`
   
   ![alt text](screen/0/0.3.png)

   Даём всем пользователям права на чтение (a+r) скачанного GPG-ключа.
   
   ![alt text](screen/0/0.4.png)

   Формируем строку с репозиторием Docker, подставляя текущую архитектуру системы и кодовое имя Ubuntu, затем сохраняем её в `/etc/apt/sources.list.d/docker.list`
   
   ![alt text](screen/0/0.5.png)

   - `arch=$(dpkg --print-architecture)` — автоматически определяет архитектуру (например, amd64).

   - `signed-by=/etc/apt/keyrings/docker.asc` — указывает путь к GPG-ключу для проверки подписи.

   - `/etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}"` — извлекает кодовое имя дистрибутива (например, jammy).

   - `tee > /dev/null` — записывает строку в файл, подавляя вывод в терминал.

   Обновляем список пакетов с учетом нового репозитория Docker.
   
   ![alt text](screen/0/0.6.png)

   Установливаем пакеты Docker.
   
   ![alt text](screen/0/0.7.png)

   Убеждаемся, что установка прошла успешно, запустив hello-world образ:
   
   ![alt text](screen/0/0.8.png)


## Part 1. Готовый докер

Возьми официальный докер-образ с nginx и выкачай его при помощи docker pull.

![alt text](screen/1/1.1.png)

Запусти докер-образ через docker run -d [image_id|repository].

![alt text](screen/1/1.2.png)

Проверь, что образ запустился через docker ps.

![alt text](screen/1/1.3.png)

![alt text](screen/1/1.4.png)

Посмотри информацию о контейнере через docker inspect [container_id|container_name].

![alt text](screen/1/1.4.2.png)


По выводу команды определи и помести в отчёт размер контейнера, список замапленных портов и ip контейнера.
   - размер контейнера
      
      ![alt text](screen/1/1.5.1.png)
   
   - список замапленных порто

      ![alt text](screen/1/1.5.2.png)

   - ip контейнера

      ![alt text](screen/1/1.5.3.png)

Останови докер контейнер через docker stop [container_id|container_name].

![alt text](screen/1/1.6.png)

Проверь, что контейнер остановился через docker ps.

![alt text](screen/1/1.7.png)

Запусти докер с портами 80 и 443 в контейнере, замапленными на такие же порты на локальной машине, через команду run.

![alt text](screen/1/1.8.png)

Проверь, что в браузере по адресу localhost:80 доступна стартовая страница nginx.

![alt text](screen/1/1.9.png)

Перезапусти докер контейнер через docker restart [container_id|container_name].

![alt text](screen/1/1.10.png)

Проверь любым способом, что контейнер запустился.

![alt text](screen/1/1.11.png)

## Part 2. Операции с контейнером

Прочитаем конфигурационный файл nginx.conf внутри докер контейнера через команду exec.

![alt text](screen/2/2.0.png)


Создаем на локальной машине файл nginx.conf.

![alt text](screen/2/2.1.png)


Настроем в нем по пути /status отдачу страницы статуса сервера nginx.

![alt text](screen/2/2.2.png)


Скопируем созданный файл nginx.conf внутрь докер-образа через команду docker cp.

![alt text](screen/2/2.3.png)


Перезапустим nginx внутри докер-образа через команду exec.

![alt text](screen/2/2.4.png)


Проверим, что по адресу localhost:80/status отдается страничка со статусом сервера nginx.

![alt text](screen/2/2.5.png)


Экспортируем контейнер в файл container.tar через команду export.

![alt text](screen/2/2.6.png)


Останавливаем контейнер.

![alt text](screen/2/2.7.png)


Удаляем остановленный контейнер.

![alt text](screen/2/2.8.png)

Импортируем контейнер обратно через команду import.

![alt text](screen/2/2.9.png)

Запустим импортированный контейнер.

![alt text](screen/2/2.10.png)

Проверяем, что по адресу localhost:80/status отдается страничка со статусом сервера nginx.

![alt text](screen/2/2.11.png)


## Part 3. Мини веб-сервер


Напиши мини-сервер на C и FastCgi, который будет возвращать простейшую страничку с надписью Hello, World!.

![alt text](screen/3/3.0.png)

Запусти написанный мини-сервер через spawn-fcgi на порту 8080.

![alt text](screen/3/3.1.png)

![alt text](screen/3/3.2.png)


Напиши свой nginx.conf, который будет проксировать все запросы с 81 порта на 127.0.0.1:8080.

![alt text](screen/3/3.3.png)

Запусти локально nginx с написанной конфигурацией.

![alt text](screen/3/3.4.png)
![alt text](screen/3/3.5.png)


Проверь, что в браузере по localhost:81 отдается написанная тобой страничка.

![alt text](screen/3/3.6.png)

## Part 4. Свой докер

Напиши свой докер-образ, который:

1) собирает исходники мини сервера на FastCgi из Части 3;

2) запускает его на 8080 порту;

3) копирует внутрь образа написанный ./nginx/nginx.conf;

4) запускает nginx.

![alt text](screen/4/4.0.png)

![alt text](screen/4/4.1.png)

nginx можно установить внутрь докера самостоятельно, а можно воспользоваться готовым образом с nginx'ом, как базовым.

Собери написанный докер-образ через docker build при этом указав имя и тег.

![alt text](screen/4/4.2.png)

Проверь через docker images, что все собралось корректно.

![alt text](screen/4/4.8.png)


Запусти собранный докер-образ с маппингом 81 порта на 80 на локальной машине и маппингом папки ./nginx внутрь контейнера по адресу, где лежат конфигурационные файлы nginx'а (см. Часть 2).

![alt text](screen/4/4.3.png)


Проверь, что по localhost:80 доступна страничка написанного мини сервера.

![alt text](screen/4/4.4.png)


Допиши в ./nginx/nginx.conf проксирование странички /status, по которой надо отдавать статус сервера nginx.

![alt text](screen/4/4.5.png)

Пересобери докер-образ.
Если всё сделано верно, то, после сохранения файла и перезапуска контейнера, конфигурационный файл внутри докер-образа должен обновиться самостоятельно без лишних действий.

![alt text](screen/4/4.6.png)


Проверь, что теперь по localhost:80/status отдается страничка со статусом nginx

![alt text](screen/4/4.7.png)


## Part 5. Dockle

Просканируй образ из предыдущего задания через dockle [image_id|repository].

![alt text](screen/5/5.2.png)

Исправь образ так, чтобы при проверке через dockle не было ошибок и предупреждений.

![alt text](screen/5/5.1.png)

Повторно сканируем

![alt text](screen/5/5.0.png)

## Part 6. Базовый Docker Compose

Напиши файл docker-compose.yml, с помощью которого:

1) Подними докер-контейнер из Части 5 (он должен работать в локальной сети, т. е. не нужно использовать инструкцию EXPOSE и мапить порты на локальную машину).

2) Подними докер-контейнер с nginx, который будет проксировать все запросы с 8080 порта на 81 порт первого контейнера.

Замапь 8080 порт второго контейнера на 80 порт локальной машины.

Cоздаем директорию server, где меняем настройки в файле nginx.conf:

![alt text](screen/6/6.0.png)

Меняем настройки в Dockerfile server:

![alt text](screen/6/6.1.png)

Создаем файл docker-compose.yml:

![alt text](screen/6/6.2.png)

Останови все запущенные контейнеры.

![alt text](screen/6/6.3.png)

Собери и запусти проект с помощью команд docker-compose build и docker-compose up.

![alt text](screen/6/6.4.png)

![alt text](screen/6/6.5.png)

Проверь, что в браузере по localhost:80 отдается написанная тобой страничка, как и ранее.

![alt text](screen/6/6.6.png)